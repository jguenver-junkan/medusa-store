import{f as A}from"./chunk-IR5DHEKS-aVJcUHa1.js";import{T as B,a as H}from"./chunk-MSDRGCRR-CJJ34J4_.js";import{u as N}from"./chunk-W7625H47-BfKW2yF9.js";import{a1 as O,ad as I,a3 as Q,R as V,aS as $,j as t,b,a8 as G,a9 as K,r as d,eK as U,eN as Z,t as S,B as j,k as J}from"./index-oLtKV1Ux.js";import{u as W,D as X}from"./chunk-HRTYC4AL-Cv-xTLnn.js";import"./lodash-BQPOQPbG.js";import{u as Y}from"./chunk-C76H5USB-VLX403Ju.js";import"./chunk-OXA2WNST-SUxUod8m.js";import"./chunk-BNLHRJ2A-Dbt8kFSd.js";import"./chunk-KHOKHZC6-I23na9JB.js";import{R as m,u as ee}from"./chunk-6DAFMWMA-DcFXWLP6.js";import{C as y}from"./checkbox-DUCWB_Nj.js";import{c as k}from"./index-CgI6BRDf.js";import"./chunk-P3UUX2T6-DnUA5WKI.js";import"./chunk-YEDAFXMB-BJZC5lZ4.js";import"./chunk-AOFGTNG6-BswFuWR8.js";import"./chunk-WX2SMNCD-CfHnLN5T.js";import"./plus-mini-Dt4gvBBt.js";import"./command-bar-BwZPhbxc.js";import"./index-C-zGjL7k.js";import"./chunk-CI243JRA-Dpv-K69h.js";import"./format-C8xOVGEJ.js";import"./date-picker-OqO4Himc.js";import"./clsx-B-dksMZM.js";import"./popover-Cu6DVetU.js";import"./x-mark-mini-CknGqCj5.js";import"./triangle-left-mini-BxOUHAZM.js";import"./prompt-D1yV89PX.js";var te=k(),re=()=>{const{t:r}=b();return d.useMemo(()=>[te.accessor("id",{header:()=>t.jsx(B,{text:"Provider"}),cell:({getValue:e})=>t.jsx(H,{text:A(e())})})],[r])},se=({prefix:r,pageSize:e=20})=>{const s=Y(["offset","q","stock_location_id"],r),{offset:i,q:n,stock_location_id:u}=s;return{searchParams:{limit:e,offset:i?Number(i):0,stock_location_id:u,q:n},raw:s}},oe=O({fulfillment_providers:I(Q()).optional()}),f=50,ie=({location:r})=>{var v,x;const{t:e}=b(),{handleSuccess:s}=ee(),i=G({defaultValues:{fulfillment_providers:((v=r.fulfillment_providers)==null?void 0:v.map(o=>o.id))??[]},resolver:K(oe)}),{setValue:n}=i,u=((x=r.fulfillment_providers)==null?void 0:x.reduce((o,a)=>(o[a.id]=!0,o),{}))??{},[c,_]=d.useState(u);d.useEffect(()=>{const o=Object.keys(c);n("fulfillment_providers",o,{shouldDirty:!0,shouldTouch:!0})},[c,n]);const{searchParams:C,raw:F}=se({pageSize:f}),{fulfillment_providers:T,count:p,isLoading:w,isError:R,error:E}=U({...C,is_enabled:!0},{placeholderData:J}),D=N(),h=le(),{table:L}=W({data:T??[],columns:h,count:p,enablePagination:!0,enableRowSelection:!0,rowSelection:{state:c,updater:_},getRowId:o=>o.id,pageSize:f}),{mutateAsync:z,isPending:M}=Z(r.id),q=i.handleSubmit(async o=>{var P;const a=(P=r.fulfillment_providers)==null?void 0:P.map(l=>l.id),g=o.fulfillment_providers??[];await z({add:g.filter(l=>!(a!=null&&a.includes(l))),remove:a==null?void 0:a.filter(l=>!g.includes(l))},{onSuccess:()=>{S.success(e("stockLocations.fulfillmentProviders.successToast")),s(`/settings/locations/${r.id}`)},onError:l=>{S.error(l.message)}})});if(R)throw E;return t.jsx(m.Form,{form:i,children:t.jsxs("div",{className:"flex h-full flex-col overflow-hidden",children:[t.jsx(m.Body,{children:t.jsx(X,{table:L,columns:h,pageSize:f,isLoading:w,count:p,filters:D,search:"autofocus",pagination:!0,orderBy:[{key:"id",label:e("fields.id")}],queryObject:F,layout:"fill"})}),t.jsx(m.Footer,{children:t.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[t.jsx(m.Close,{asChild:!0,children:t.jsx(j,{size:"small",variant:"secondary",children:e("actions.cancel")})}),t.jsx(j,{size:"small",isLoading:M,onClick:q,children:e("actions.save")})]})})]})})},ae=k(),le=()=>{const r=re();return d.useMemo(()=>[ae.display({id:"select",header:({table:e})=>t.jsx(y,{checked:e.getIsSomePageRowsSelected()?"indeterminate":e.getIsAllPageRowsSelected(),onCheckedChange:s=>e.toggleAllPageRowsSelected(!!s)}),cell:({row:e})=>t.jsx(y,{checked:e.getIsSelected(),onCheckedChange:s=>e.toggleSelected(!!s),onClick:s=>{s.stopPropagation()}})}),...r],[r])},qe=()=>{const{location_id:r}=V(),{stock_location:e,isPending:s,isFetching:i,isError:n,error:u}=$(r,{fields:"id,*fulfillment_providers"}),c=!s&&!i&&!!e;if(n)throw u;return t.jsx(m,{children:c&&t.jsx(ie,{location:e})})};export{qe as Component};
